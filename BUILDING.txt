    This file is part of "Filter Foundry", a filter plugin for Adobe Photoshop
    Copyright (C) 2003-2019 Toby Thain, toby@telegraphics.com.au

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by  
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License  
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA


Building the Filter Foundry plugin for Photoshop
------------------------------------------------

Notes on source code
--------------------
Source code, makefiles and IDE projects under GPL license are provided
for MPW (Classic & Carbon PowerPC targets), CodeWarrior 7
(Classic & Carbon PowerPC, Win32, 68K targets) and mingw32 (Win32 target).

A Photoshop SDK is required (available from Adobe Systems, http://www.adobe.com/).
The SDK was also distributed with Photoshop 6.0 and earlier.

The source has been built with SDK 6.0, CS2 and CS3 beta, but older
versions can be used.
(If building with SDK v4, edit 68k.r, carbon.r, classic.r, and PiMI_68k.r
to remove references to "PIResDefines.h", "PiPL.r" and "PiMI.r" and replace
with a single #include "PIGeneral.r"; also remove "fmtCanWriteTransparency"
from PiPL_common.r.)

Before attempting to build, you must edit the makefiles
("FilterFoundry.make" for MPW, "Makefile" for mingw32 or OS X), or change your
CodeWarrior project's access paths, to reflect the SDK's installed location.

In order to build the Carbon plugin with an SDK prior to version 7.0,
it is necessary to edit the SDK file :PhotoshopAPI:Resources:PIPL.r
as follows:
1. find the line "case CodePowerPC:"
2. duplicate the next 15 lines
3. in the copy only, change "case CodePowerPC:" to "case CodeCarbonPowerPC:"
   and change the 5 occurrences of "pwpc" to "ppcb"

Photoshop 7.0, CS and CS2 will load Carbon/PEF plugins built in this manner.
Only CodeWarrior and MPW can build these.

Photoshop CS2 also supports Mach-O format plugins. For details on how
these are built, see the Makefile (target "osx"). 

Photoshop CS3 supports "universal" (or "fat") plugins having native code
for both PowerPC and Intel architectures. The provided Makefile can build
a "universal" plugin if you have the CS3 "Beta" SDK (use target "fat").

Note that building Mach-O plugins requires Apple's Developer Tools
be installed (from the DVD that came with your Mac, or download from
http://developer.apple.com/ if you have an ADC login).


Mac notes
---------
The Mac build requires Apple's MoreFiles library, which can be obtained via
http://developer.apple.com/samplecode/Sample_Code/Files/MoreFiles.htm

Depending on how the source files were extracted, it may be necessary to set
the correct Mac file types before attempting to build. In MPW, this can
be done as follows. First set the current directory to the Filter Foundry
source directory, then:
	setfile -t TEXT Å.[chrly] Å.make Å.rc ::common:tt:Å ::common:adobeplugin:Å
This can also be necessary after regenerating y.tab.c and lex.yy.c.
These files are generated from the parser and lexical analyser definitions,
parser.y and lexer.l, by a UNIX Terminal (not MPW!) command such as:
	make y.tab.c lex.yy.c

If building with MPW, finished binaries are left in the "debug" directory;
these are good for testing and debugging, as they can be updated
and re-run without having to re-launch Photoshop.

The finished binary, which contains executables for Classic and Carbon,
is left in the "dist" directory.


Windows notes
-------------

BUILDING WITH VISUAL STUDIO
(Most recently tested with Visual C++ 2017 with Adobe Photoshop SDK CC 2017):

	1. First download Flex and Bison from https://sourceforge.net/projects/winflexbison/
	   and unpack them on your disk.
	2. Download the Adobe Photoshop SDK from https://www.adobe.com/devnet/photoshop/sdk.html
	   and unpack it on your disk.
	3. Download the Telegraphics common library from http://telegraphics.com.au/svn/common/trunk/
	   and unpack it on your disk. Please make sure that "common" and "Source" (of FilterFoundry)
	   are placed in the same directory.
	4. a) If you want to use the IDE:
	      - Open the visual_studio\FilterFoundry.sln
	      - Adjust the paths in the project settings:
	        Path to Adobe plugin SDK (in C/C++ category, and Resource category)
	        Path to win_flex and win_bison (pre-build-events)
	      - You can now compile the x86 and x64 plugin inside the IDE.
	   b) If you want to use CLI/nmake:
	      - Adjust the paths in the visual_studio\nmake.mak and visual_studio\nmake64.mak files:
	        Path to Adobe plugin SDK (in C/C++ category, and Resource category)
	        Path to win_flex and win_bison (pre-build-events)
	      - Edit visual_studio\vc_make_3264.bat: Change the Visual Studio path to the one you have on your system.
	      - You can now use the script visual_studio\vc_make_3264.bat to build both x86 and x64 with one click.

	Troubleshooting:
	- If "rc" can't be found, install the Windows 10 SDK, and then copy
	  C:\Program Files (x86)\Windows Kits\10\bin\...\x64 to C:\Program Files (x86)\Windows Kits\10\bin\x86
	  see also https://stackoverflow.com/questions/43847542/rc-exe-no-longer-found-in-vs-2015-command-prompt
	- If lex.yy.c can't be found, check the flex command (it generates lex.yy.c)
	- If nmake gives the error message "makefile(28) : fatal error U1000: Syntax error: ")" missing in macro invocation"
	  then run nmake with the parameter "/f nmake.mak" or "/f nmake64.mak"
	  (nmake calls Makefile by default, which is not optimized for nmake)
	- If you run into any problems, try "nmake /f nmake.mak clean" followed by "nmake /f nmake.mak",
	  or for 64 bit: "nmake /f nmake64.mak clean" followed by "nmake /f nmake64.mak"
	  It is necessary to run the "clean" command when switching between 32bit and 64 bit building.
	- Since the RC files have a complex structure, you cannot edit the resources inside the IDE. You have to edit
	  the *.rc files manually.

BUILDING WITH OPEN WATCOM
(Most recently tested with Open Watcom 1.9 with Adobe Photoshop SDK CC 2017):

	To build in Windows with the OpenWatcom IDE, see the wpj
	subdirectory and notes (README.TXT) kindly provided by Peter Heckert and Daniel Marschall.


Development systems
-------------------
While a CodeWarrior 7 project is provided, MPW and mingw32 are recommended 
as they produce much smaller executables.

Mingw32 (http://www.mingw.org/) can be hosted on virtually any UNIX or
Linux system, or under Windows.

MPW (http://developer.apple.com/tools/mpw-tools/) runs on PowerPC and
68K Macs under Mac OS 9 or earlier, or Classic under OS X.

For Windows, Visual Studio works best (the community edition is even free),
and it can compile the 32-Bit and 64-Bit plugin for Windows.
OpenWatcom can also be used, but only for 32 Bit, and it is officially not
supported by Adobe.